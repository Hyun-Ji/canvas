var join = require('path').join;
var minimist = require('minimist');

var defaults = {
  dest: 'dist',
  cwd: process.cwd(),
  include: 'relative',
  ignore: [],
  idleading: '{{name}}/{{version}}'
};

module.exports = function buildArgs(options) {
  var opt = extend({}, defaults, options);
  var pkg = join(opt.cwd, 'package.json');
  var args = parserBuildArgs(pkg);
  delete args['_'];
  return extend({}, defaults, args, options);
};

function parserBuildArgs(pkg) {
  pkg = require(pkg);
  var args = pkg.spm ? pkg.spm.buildArgs : '';
  return minimist((args || '').split(/\s+/));
}

function extend(target) {
  var args = Array.prototype.slice.call(arguments, 1);
  for (var i in args) {
    var obj = args[i];
    for (var j in obj) {
      if (typeof obj[j] !== 'undefined' && obj[j] !== null) {
        target[j] = obj[j];
      }
    }
  }
  return target;
}
